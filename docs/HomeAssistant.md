Home Assistant can be installed in docker on the UCM-Pi. There is not enough capacity on a CM3, so a CM3+ with 32Gb of storage is highly recommended

First, ssh into the UCM-Pi after following the general install process, and run the following

```bash
curl -sSL https://get.docker.com | sh
sudo usermod -aG docker pi
mkdir ~/alphawerk/homeassistant
```

Now, download and create a docker container to run Home-Assistant within. If you don't want to use ZWave with Home-Assistant, the following command will create a container which will automatically restart upon boot, store all the configuration data in ~/alphawerk/homeassistant and use the local time of the Pi.

```
sudo docker run --init -d --restart=unless-stopped --name="home-assistant"  -v /home/pi/alphawerk/homeassistant:/config -v /etc/timezone:/etc/timezone --net=host homeassistant/raspberrypi3-homeassistant:stable
```

The following also redirects the Z-Wave device to homne assitant if you wish to use a Z-Wave usb controlled from within Home-Assistant (Please note the name of the device may not be that of your USB adapter)

```
sudo docker run --init -d --restart=unless-stopped --name="home-assistant" -v /home/pi/alphawerk/homeassistant:/config -v /etc/timezone:/etc/timezone --device=/dev/zwave --net=host homeassistant/raspberrypi3-homeassistant:stable
```

If you wish to share device status and control between Home-Assistant and Comfort you will also need to do the following:

1. Install the MQTT adapter in Home-Assistant, referencing the local MQTT server (127.0.0.1) and enable discovery. (Username and Password is not necessary as it is limited to localhost only).
2. Cope and Paste the flow below into a new flow in Node-Red.

```
[{"id":"5a84329134f16955","type":"tab","label":"Home Assistant Integration","disabled":false,"info":"","env":[]},{"id":"4e54a4dacc8c9ad7","type":"cytech zone event","z":"5a84329134f16955","name":"Zones","zone":"*","event":"*","trigger":true,"setvirtualinput":false,"setvirtualinputparam":"payload.value","setbypass":false,"setbypassparam":"payload.bypass","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload","x":110,"y":140,"wires":[["27279d411f6b004a"]]},{"id":"1d2e7259adf2efaf","type":"debug","z":"5a84329134f16955","name":"Zone Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":610,"y":140,"wires":[]},{"id":"8863e3159267f567","type":"function","z":"5a84329134f16955","name":"Generate Zone and Output Id's","func":"for (var id = 0; id<97; id++) {\n    msg.payload = {\"id\":id};\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":80,"wires":[["4e54a4dacc8c9ad7","0dd09da8877f7d10","1818fe07a3ac4649"]]},{"id":"2caf908f87c6fb5b","type":"inject","z":"5a84329134f16955","name":"Discover Zones and Outputs","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"30","topic":"","payload":"","payloadType":"date","x":180,"y":40,"wires":[["8863e3159267f567"]]},{"id":"27279d411f6b004a","type":"function","z":"5a84329134f16955","name":"Extract Zone State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\n\nif (msg.payload.status.zone.zonetypename == \"\") {\n    return;\n}\n\nlet state = msg.payload.status.value;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": (msg.payload.status.zone.zoneword1 + \" \" + msg.payload.status.zone.zoneword2 + \" \" + msg.payload.status.zone.zoneword3 + \" \" + msg.payload.status.zone.zoneword4).replaceAll(\"undefined\", \"\").trim(),\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"object_id\": \"zone_\" + msg.payload.status.index,\n    \"state_topic\":\"homeassistant/binary_sensor/comfort/zone\" + id + \"/state\",\n    \"unique_id\": \"comfort.binary_sensor.zone\" + id      \n};\n\nswitch (msg.payload.status.zone.zonetypename) {\n    case \"PerimAway\":\n    case \"PIRNightAway\":\n    case \"PIRAway\":\n        config.device_class = \"motion\"  \n        break;\n    case \"DoorWindow\":\n    case \"SwitchNC\":\n    case \"EntryDoor\":\n    case \"IntrNightAway\":\n        config.device_class = \"door\"\n        break;\n    case \"DoorBell\":\n        config.icon = \"mdi:doorbell\"\n        //config.device_class = \"sound\"\n        break;\n    case \"MonitorNO\":\n        config.icon = \"mdi:toggle-switch\"\n        //config.device_class = \"switch\"\n        break;     \n    default:\n        break;\n    }\n\nif (msg.payload.status.zone.virtualinput == \"true\") {\n    config.command_topic = \"homeassistant/binary_sensor/comfort/zone\" + id + \"/command\"\n}\n\nmsg.topic = \"homeassistant/binary_sensor/comfort/zone\" + id + \"/config\"    \nmsg.zone = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nif (state==0) {\n    msg.payload = \"OFF\"\n} else {\n    msg.payload = \"ON\"\n}\nnode.send(msg)\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":140,"wires":[["1d2e7259adf2efaf","c408e30ad88a8030"]]},{"id":"c408e30ad88a8030","type":"mqtt out","z":"5a84329134f16955","name":"","topic":"","qos":"","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"f35ad748.1790a8","x":590,"y":180,"wires":[]},{"id":"0dd09da8877f7d10","type":"cytech output event","z":"5a84329134f16955","name":"Outputs","output":"*","trigger":true,"setvalue":false,"setvalueparam":"payload","inputtype":"passive","activewait":"30","outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload","x":120,"y":300,"wires":[["affa7c2fea09ff57"]]},{"id":"affa7c2fea09ff57","type":"function","z":"5a84329134f16955","name":"Extract Output State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\nif (String(msg.payload.status.output.name).match(/^Output\\d{1,3}$/)) {\n    return;\n}\n\nlet state = msg.payload.status.value;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": \"Output \" + msg.payload.status.output.name,\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"state_topic\":\"homeassistant/switch/comfort/output\" + id + \"/state\",\n    \"command_topic\" : \"homeassistant/switch/comfort/output\" + id + \"/command\",\n    \"device_class\":\"switch\",\n    \"object_id\": \"output_\" + msg.payload.status.index,\n    \"unique_id\": \"comfort.switch.output\" + id     \n};\n\nif (String(config.name).toUpperCase().includes(\"LIGHT\")) {\n    config.icon = \"mdi:lightbulb\"\n} else if (String(config.name).toUpperCase().includes(\"FLOOD\")) {\n    config.icon = \"mdi:light-flood-down\"\n}\n  \nmsg.topic = \"homeassistant/switch/comfort/output\" + id + \"/config\"    \nmsg.output = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nif (state==0) {\n    msg.payload = \"OFF\"\n} else {\n    msg.payload = \"ON\"\n}\nnode.send(msg)\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":300,"wires":[["c9d9c3841c9c9112","c408e30ad88a8030"]]},{"id":"c9d9c3841c9c9112","type":"debug","z":"5a84329134f16955","name":"Output Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":620,"y":300,"wires":[]},{"id":"b96b874e4d8f1064","type":"mqtt in","z":"5a84329134f16955","name":"","topic":"homeassistant/+/comfort/+/command","qos":"2","datatype":"auto-detect","broker":"f35ad748.1790a8","nl":false,"rap":true,"rh":0,"inputs":0,"x":930,"y":80,"wires":[["dd93cf54e43ba01d","f8cd37986fd49180"]]},{"id":"dd93cf54e43ba01d","type":"debug","z":"5a84329134f16955","name":"Command Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1210,"y":80,"wires":[]},{"id":"f8cd37986fd49180","type":"change","z":"5a84329134f16955","name":"","rules":[{"t":"set","p":"payload_backup","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"payload_backup","tot":"msg"},{"t":"set","p":"type","pt":"msg","to":"$replace($split(msg.topic, \"/\")[3],/[0123456789*]/,\"\")","tot":"jsonata"},{"t":"set","p":"payload.id","pt":"msg","to":"$replace($split(msg.topic, \"/\")[3],/[^0123456789*]/,\"\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":140,"wires":[["05d74c02314ca03f"]]},{"id":"05d74c02314ca03f","type":"switch","z":"5a84329134f16955","name":"","property":"type","propertyType":"msg","rules":[{"t":"eq","v":"zone","vt":"str"},{"t":"eq","v":"output","vt":"str"},{"t":"eq","v":"zone_bypass","vt":"str"},{"t":"eq","v":"counter","vt":"str"},{"t":"eq","v":"sensor","vt":"str"},{"t":"eq","v":"alarm","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":1010,"y":160,"wires":[["e6dc3016bf994bb8"],["128025796e1f0790"],["4b3ab08722b8a4d6"],["f06f6da95d7a0370"],["c8a209d3a5b2618c"],["f78e163842577de5"]]},{"id":"128025796e1f0790","type":"cytech output event","z":"5a84329134f16955","name":"Outputs","output":"*","trigger":true,"setvalue":true,"setvalueparam":"payload.value","inputtype":"off","activewait":5,"outputtype":"simplified","outputsimplifiedvalue":"onoff","outputsimplifiedkey":"payload","x":1180,"y":160,"wires":[[]]},{"id":"e6dc3016bf994bb8","type":"cytech zone event","z":"5a84329134f16955","name":"Virtual Zone","zone":"*","event":"*","trigger":false,"setvirtualinput":true,"setvirtualinputparam":"payload.value","setbypass":false,"setbypassparam":"payload.bypass","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload","x":1190,"y":120,"wires":[[]]},{"id":"1818fe07a3ac4649","type":"cytech zone event","z":"5a84329134f16955","name":"Zone Bypass","zone":"*","event":"bypass","trigger":true,"setvirtualinput":false,"setvirtualinputparam":"payload.value","setbypass":false,"setbypassparam":"payload.bypass","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload.status","x":130,"y":220,"wires":[["cce0a4ee2cf80369"]]},{"id":"cce0a4ee2cf80369","type":"function","z":"5a84329134f16955","name":"Extract Zone Bypass","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\n\nif (msg.payload.status.zone.zonetypename==\"\") {\n    return;\n}\n\nlet state = msg.payload.status.bypass;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": (msg.payload.status.zone.zoneword1 + \" \" + msg.payload.status.zone.zoneword2 + \" \" + msg.payload.status.zone.zoneword3 + \" \" + msg.payload.status.zone.zoneword4).replaceAll(\"undefined\", \"\").trim()+\" bypass\",\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"device_type\": \"switch\",\n    \"command_topic\": \"homeassistant/switch/comfort/zone_bypass\" + id + \"/command\",  \n    \"state_topic\":\"homeassistant/switch/comfort/zone_bypass\" + id + \"/state\",\n    \"object_id\": \"zone_bypass\" + msg.payload.status.index,\n    \"unique_id\": \"comfort.switch.zone_bypass\" + id      \n};\n \nmsg.topic = \"homeassistant/switch/comfort/zone_bypass\" + id + \"/config\"    \nmsg.zone = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nif (state==0) {\n    msg.payload = \"OFF\"\n} else {\n    msg.payload = \"ON\"\n}\nnode.send(msg)","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":220,"wires":[["c408e30ad88a8030","c5802ab3345c9219"]]},{"id":"c5802ab3345c9219","type":"debug","z":"5a84329134f16955","name":"Zone Bypass Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":640,"y":220,"wires":[]},{"id":"4b3ab08722b8a4d6","type":"cytech zone event","z":"5a84329134f16955","name":"Zone Bypass","zone":"*","event":"*","trigger":false,"setvirtualinput":false,"setvirtualinputparam":"payload.value","setbypass":true,"setbypassparam":"payload.value","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload","x":1190,"y":200,"wires":[[]]},{"id":"94c5cfc2068562b9","type":"cytech flag event","z":"5a84329134f16955","name":"","flag":"*","trigger":true,"setvalue":false,"setvalueparam":"payload","inputtype":"active","activewait":5,"outputtype":"detailed","outputsimplifiedvalue":"boolean","outputsimplifiedkey":"payload","x":110,"y":460,"wires":[["7055161068e91074"]]},{"id":"7cad3b963f4f61a8","type":"function","z":"5a84329134f16955","name":"Generate Flag and Counter Id's","func":"for (var id = 0; id<257; id++) {\n    msg.payload = {\"id\":id};\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":400,"wires":[["94c5cfc2068562b9","6dc04e2c8a52366f"]]},{"id":"b0dd85ac872aa8e9","type":"inject","z":"5a84329134f16955","name":"Discover Flags and Counters","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"90","topic":"","payload":"","payloadType":"date","x":180,"y":360,"wires":[["7cad3b963f4f61a8"]]},{"id":"7055161068e91074","type":"function","z":"5a84329134f16955","name":"Extract Flag State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\n\nif (String(msg.payload.status.flag.name).match(/^Flag\\d{1,3}$/)) {\n    return;\n}\n\nlet state = msg.payload.status.value;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": \"Flag \" + msg.payload.status.flag.name,\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"state_topic\":\"homeassistant/switch/comfort/flag\" + id + \"/state\",\n    \"command_topic\" : \"homeassistant/switch/comfort/flag\" + id + \"/command\",\n    \"device_class\":\"switch\",\n    \"object_id\": \"flag_\" + id,\n    \"icon\": \"mdi:flag\",\n    \"unique_id\": \"comfort.switch.flag\" + id      \n};\n \nmsg.topic = \"homeassistant/switch/comfort/flag\" + id + \"/config\"    \nmsg.flag = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nif (state==0) {\n    msg.payload = \"OFF\"\n} else {\n    msg.payload = \"ON\"\n}\nnode.send(msg)\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":460,"wires":[["f59b90e5e79f2d54","628022fe1a5f034e"]]},{"id":"f59b90e5e79f2d54","type":"mqtt out","z":"5a84329134f16955","name":"","topic":"","qos":"","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"f35ad748.1790a8","x":590,"y":460,"wires":[]},{"id":"628022fe1a5f034e","type":"debug","z":"5a84329134f16955","name":"Flag Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":610,"y":400,"wires":[]},{"id":"6dc04e2c8a52366f","type":"cytech counter event","z":"5a84329134f16955","name":"","counter":"*","trigger":true,"setvalue":false,"setvalueparam":"payload","inputtype":"active","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","x":120,"y":520,"wires":[["313df8bc962ec4ce"]]},{"id":"9467bb628a2f8c4b","type":"debug","z":"5a84329134f16955","name":"Counter Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":620,"y":520,"wires":[]},{"id":"313df8bc962ec4ce","type":"function","z":"5a84329134f16955","name":"Extract Counter State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\n\nif (String(msg.payload.status.counter.name).match(/^Counter\\d{1,3}$/)) {\n    return;\n}\n\nlet state = msg.payload.status.value;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": \"Counter \" + msg.payload.status.counter.name,\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"state_topic\":\"homeassistant/number/comfort/counter\" + id + \"/state\",\n    \"command_topic\" : \"homeassistant/number/comfort/counter\" + id + \"/command\",\n    //\"device_class\":\"number\",\n    \"object_id\": \"counter_\" + id,\n    \"icon\": \"mdi:counter\",\n    \"unique_id\": \"comfort.number.counter\" + id      \n};\n \nmsg.topic = \"homeassistant/number/comfort/counter\" + id + \"/config\"    \nmsg.counter = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nmsg.payload = state;\nnode.send(msg);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":520,"wires":[["9467bb628a2f8c4b","f59b90e5e79f2d54"]]},{"id":"f06f6da95d7a0370","type":"cytech counter event","z":"5a84329134f16955","name":"Set Counter","counter":"*","trigger":false,"setvalue":true,"setvalueparam":"payload.value","inputtype":"off","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","x":1190,"y":240,"wires":[[]]},{"id":"5c4c7465a2bf5e36","type":"cytech sensor event","z":"5a84329134f16955","name":"Sensor","sensor":"*","trigger":true,"setvalue":false,"setvalueparam":"payload","inputtype":"active","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","x":120,"y":680,"wires":[["72eec5602813a954"]]},{"id":"73a60e6a76aa9076","type":"function","z":"5a84329134f16955","name":"Generate Sensor Id's","func":"for (var id = 0; id<32; id++) {\n    msg.payload = {\"id\":id};\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":640,"wires":[["5c4c7465a2bf5e36"]]},{"id":"b6d624e6d45905fd","type":"inject","z":"5a84329134f16955","name":"Discover Sensors","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"90","topic":"","payload":"","payloadType":"date","x":150,"y":580,"wires":[["73a60e6a76aa9076"]]},{"id":"72eec5602813a954","type":"function","z":"5a84329134f16955","name":"Extract Sensor State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\n\nif (String(msg.payload.status.sensor.name).match(/^Sensor\\d{1,3}$/)) {\n    return;\n}\n\nlet state = msg.payload.status.value;\nlet id = msg.payload.status.index;\nlet config = {\n    \"name\": \"Sensor \" + msg.payload.status.sensor.name,\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"state_topic\":\"homeassistant/number/comfort/sensor\" + id + \"/state\",\n    \"command_topic\" : \"homeassistant/number/comfort/sensor\" + id + \"/command\",\n    //\"device_class\":\"number\",\n    \"object_id\": \"sensor_\" + id,\n    \"icon\": \"mdi:counter\",\n    \"unique_id\":\"comfort.number.sensor\"+id    \n};\n \nmsg.topic = \"homeassistant/number/comfort/sensor\" + id + \"/config\"    \nmsg.counter = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nmsg.payload = state;\nnode.send(msg);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":680,"wires":[["4c2bdec861fcc1b4","f59b90e5e79f2d54"]]},{"id":"4c2bdec861fcc1b4","type":"debug","z":"5a84329134f16955","name":"Sensor Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":620,"y":680,"wires":[]},{"id":"c8a209d3a5b2618c","type":"cytech sensor event","z":"5a84329134f16955","name":"Set Sensor Value","sensor":"*","trigger":false,"setvalue":true,"setvalueparam":"payload.value","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","x":1210,"y":280,"wires":[[]]},{"id":"53213fd3aeb25aba","type":"cytech alarm mode event","z":"5a84329134f16955","name":"","trigger":true,"setmode":false,"setmodeparam":"payload.mode","setmodevalue":"cytechtext","setpassparam":"payload.passcode","setpassvalue":"1234","inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","outputmodevalue":"cytechtext","x":130,"y":780,"wires":[["9638d07ad97ac7f5"]]},{"id":"8d5695aa32ccc6cc","type":"inject","z":"5a84329134f16955","name":"Discover Alarm","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":140,"y":720,"wires":[["53213fd3aeb25aba"]]},{"id":"8201dd5a45888a4e","type":"cytech alarm status event","z":"5a84329134f16955","name":"","trigger":true,"inputtype":"passive","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","outputmodevalue":"cytechtext","x":130,"y":840,"wires":[["5169965ea0e048e5"]]},{"id":"9dbd7b7b87aff4ed","type":"debug","z":"5a84329134f16955","name":"Alarm Alert Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":630,"y":840,"wires":[]},{"id":"9638d07ad97ac7f5","type":"function","z":"5a84329134f16955","name":"Extract Alarm Mode","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\nlet state=\"unknown\"\nswitch (msg.payload.status.status) {\n    case \"off\":\n        state=\"disarmed\";\n        break;\n    case \"night\":\n        state =\"armed_night\";\n        break;\n    case \"day\":\n        state = \"armed_day\";\n        break;\n    case \"away\":\n        state = \"armed_away\";\n        break;\n    case \"vacation\":\n        state = \"armed_vacation\";\n        break;\n    case \"arming\":\n    case \"arming waiting on zone\":\n    case \"exit delay\":\n        state = \"arming\";\n        break;\n    case \"entry delay\":\n        state = \"disarming\";\n        break;\n}\n\nlet config = {\n    \"name\": \"Alarm\",\n    \"manufacturer\":\"Cytech\",\n    \"model\":\"Comfort\",\n    \"state_topic\":\"homeassistant/alarm_control_panel/comfort/alarm/state\",\n    \"command_topic\": \"homeassistant/alarm_control_panel/comfort/alarm/command\",\n    \"object_id\": \"comfort_alarm\",\n    \"unique_id\": \"comfort.alarm_control_panel.alarm\",\n    \"icon\": \"mdi:shield-home\",\n    \"payload_arm_away\": \"away\",\n    \"payload_arm_home\": \"day\",\n    \"payload_arm_night\": \"night\",\n    \"payload_arm_vacation\": \"vacation\",\n    \"payload_disarm\": \"off\",\n    \"payload_arm_panic\":\"panic\",\n    \"code\":\"REMOTE_CODE\",\n    \"code_arm_required\": false,\n    \"command_template\": \"{\\\"action\\\": \\\"{{ action }}\\\", \\\"code\\\":\\\"{{code}}\\\"}\"\n\n};    \n \nmsg.topic = \"homeassistant/alarm_control_panel/comfort/alarm/config\"    \nmsg.alarm = msg.payload;\nmsg.payload = config;    \nnode.send(msg);\nmsg.topic = msg.payload.state_topic;\nmsg.payload = state;\nnode.send(msg);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":780,"wires":[["4e6541156e837b1c","f59b90e5e79f2d54"]]},{"id":"4e6541156e837b1c","type":"debug","z":"5a84329134f16955","name":"Alarm Mode Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":630,"y":780,"wires":[]},{"id":"f78e163842577de5","type":"cytech alarm mode event","z":"5a84329134f16955","name":"","trigger":false,"setmode":true,"setmodeparam":"payload.value.action","setmodevalue":"cytechtext","setpassparam":"payload.value.code","setpassvalue":"","inputtype":"off","activewait":5,"outputtype":"detailed","outputsimplifiedkey":"payload","outputmodevalue":"cytechtext","x":1190,"y":320,"wires":[[]]},{"id":"5169965ea0e048e5","type":"function","z":"5a84329134f16955","name":"Extract Alarm Alert State","func":"if (typeof msg.payload.event == \"object\") {\n    msg.payload.status = msg.payload.event\n}\nlet state=\"unknown\"\nswitch (msg.payload.status.status) {\n    case \"idle\":\n    case \"tamper\":\n    //   state=\"disarmed\";\n        break;\n    case \"alert\":\n    case \"alarm\":\n        state =\"triggered\";\n        break;\n}\nif (state!=\"unknown\") {\nmsg.topic = \"homeassistant/alarm_control_panel/comfort/alarm/state\";\nmsg.payload = state;\nnode.send(msg);\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":840,"wires":[["9dbd7b7b87aff4ed","f59b90e5e79f2d54"]]},{"id":"f35ad748.1790a8","type":"mqtt-broker","name":"SunSynk","broker":"localhost","port":"1883","clientid":"","autoConnect":true,"usetls":false,"compatmode":false,"protocolVersion":"3","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""}]
```

3. Deploy the flow and then initiate discovery by pressing clicking on the 'Disovery Nodes' Node in the newly create Home-Assistant tab.

5. You should now find all yours Zones, Outputs, Flags, Counters and Sensors and the Alarm exposed in Home-Assistant, whcih will both update status and can be controlled (where possible) from Home-Assistant.
6. 5. You may need to update the MQTT broker settings in the flow for your local MQTT server.

